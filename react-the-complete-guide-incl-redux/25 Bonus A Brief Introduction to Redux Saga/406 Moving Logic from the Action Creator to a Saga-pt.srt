1
00:00:02,150 --> 00:00:07,760
Ento trabalhmos muitas sagas, mas eu diria que ainda  um pouco confuso,

2
00:00:07,850 --> 00:00:09,850
logo ficar mais claro.

3
00:00:09,860 --> 00:00:13,020
Vamos para a auth. arquivo js na pasta

4
00:00:13,100 --> 00:00:16,840
actions, l temos nosso criador de aes de logout e

5
00:00:17,030 --> 00:00:20,080
aqui, eu quero fazer uma alterao muito importante.

6
00:00:20,210 --> 00:00:25,810
Vou pegar todo o cdigo de armazenamento local e vou coment-lo aqui, ao invs disso, eu

7
00:00:25,940 --> 00:00:28,010
realmente quero apenas despachar uma ao,

8
00:00:28,020 --> 00:00:30,530
eu quero criar uma ao, nada mais.

9
00:00:30,530 --> 00:00:35,990
Eu no quero mais ter efeitos colaterais, porque eu quero lidar com isso com o redux

10
00:00:36,010 --> 00:00:36,760
saga agora.

11
00:00:37,190 --> 00:00:45,270
Ento o que vou fazer  despachar algo aqui e vou criar um novo tipo de ao para

12
00:00:45,290 --> 00:00:54,290
isso, ento, alm do auth logout, vou exportar uma nova constante na pasta action types que nomeei AUTH_INITIATE_LOGOUT porque 

13
00:00:54,740 --> 00:00:59,220
uma espcie de passo antes de realmente sair, h um

14
00:01:00,100 --> 00:01:01,390
erro de digitao.

15
00:01:01,730 --> 00:01:08,070
Isto ir novamente como sempre receber o mesmo identificador de uma string como ns nomeamos

16
00:01:08,320 --> 00:01:17,080
a constante e agora eu vou voltar para a auth. arquivo de aes js e aqui, vou despachar os

17
00:01:17,080 --> 00:01:20,020
tipos de ao AUTH_INITIATE_LOGOUT e no

18
00:01:20,080 --> 00:01:27,290
o logout de autenticao, ento sempre que eu enviar o logout, vou simplesmente iniciar o logout.

19
00:01:27,640 --> 00:01:35,530
Agora, o objetivo  ouvir esse criador de aes recm-criado e executar nosso gerador de saga de

20
00:01:35,560 --> 00:01:43,900
logout sempre que detectarmos essa chamada de logout iniciada. Para isso, vou criar um novo arquivo na pasta sagas, vou

21
00:01:44,100 --> 00:01:45,640
nome-lo index. js, voc tambm

22
00:01:45,670 --> 00:01:50,640
pode nomear root, saga ou o que quiser. No ndice. js, vou simplesmente

23
00:01:50,720 --> 00:01:59,520
importar algo do arquivo auth saga e que, claro,  a nica saga que recebi at agora,

24
00:01:59,520 --> 00:02:01,910
a saga de logout, mas

25
00:02:02,010 --> 00:02:07,270
tambm vou importar algo desse pacote de saga do redux.

26
00:02:07,270 --> 00:02:15,820
Ento, a partir da saga do redux, eu importarei cada vez mais, essa  outra

27
00:02:15,960 --> 00:02:25,320
funo til que podemos usar e levar. Cada um nos permitir escutar certas aes e fazer algo

28
00:02:25,320 --> 00:02:27,350
quando elas ocorrerem, agora

29
00:02:27,570 --> 00:02:29,470
como vamos us-las?

30
00:02:29,550 --> 00:02:36,450
Em primeiro lugar, criamos outro gerador, portanto, uma funo com essa

31
00:02:36,450 --> 00:02:37,420
estrela aps

32
00:02:37,480 --> 00:02:46,130
a palavra-chave da funo e denominamos watchAuth. Agora aqui eu vou produzir algo como temos que fazer nos geradores,

33
00:02:46,120 --> 00:02:53,610
basicamente, dizer, execute isso e espere que ele termine e ento pegue cada um, a funo que eu importo e

34
00:02:53,630 --> 00:02:55,010
para levar todo mundo,

35
00:02:55,210 --> 00:03:03,410
eu vou agora passar a ao que eu quero ouvir, ento eu tambm importarei isso, importarei tudo como tipos de ao e

36
00:03:03,430 --> 00:03:09,820
agora vamos para a pasta actions no arquivo de tipos de ao e aqui eu escutarei todas

37
00:03:10,030 --> 00:03:12,510
as aes do tipo startout logout.

38
00:03:13,060 --> 00:03:20,130
Agora takeEvery leva um segundo argumento, este segundo argumento  o gerador, a saga que

39
00:03:20,140 --> 00:03:21,490
queremos executar quando

40
00:03:21,490 --> 00:03:26,200
esta ao ocorre e que seria a saga de logout.

41
00:03:26,200 --> 00:03:32,500
Agora no execute a funo, ento no use parnteses aqui, apenas passe uma referncia para ela.

42
00:03:32,650 --> 00:03:38,910
O que isto vai fazer  que sempre que executarmos este gerador, basicamente iremos configurar um

43
00:03:38,920 --> 00:03:45,610
ouvinte para neste caso auth authte logout e depois executar a saga de logout sempre que aparecer.

44
00:03:46,060 --> 00:03:52,300
Ento agora podemos ir ao ndice. arquivo js aqui e no queremos mais executar a saga

45
00:03:52,750 --> 00:03:56,630
de logout no incio, mas executar o gerador onde configuramos este watcher.

46
00:03:56,890 --> 00:04:04,250
Ento, no ndice. js, no importarei mais a saga de logout da autenticao

47
00:04:04,270 --> 00:04:08,430
sagas, em vez de sagas / index que posso omitir devido

48
00:04:08,470 --> 00:04:15,400
a nossa configurao aqui, quero importar nossa funo watchAuth recm-criada e, portanto,  claro, terei que adicionar a palavra-chave

49
00:04:15,410 --> 00:04:16,780
de exportao para ele.

50
00:04:16,780 --> 00:04:24,250
Agora, com isso, posso importar o watchAuth e quero executar o watchAuth, configurando o observador

51
00:04:24,250 --> 00:04:26,570
logo no incio do aplicativo.

52
00:04:26,590 --> 00:04:29,630
Agora vamos voltar ao nosso aplicativo e

53
00:04:29,630 --> 00:04:38,800
ver se isso funciona agora, se eu recarregar, tudo parece como antes, ns vemos uma mudana importante, o logout do auth initte

54
00:04:38,800 --> 00:04:40,450
 despachado e isso

55
00:04:40,450 --> 00:04:46,900
faz sentido porque agora estamos enviando isso para nosso criador de aes de logout que

56
00:04:46,900 --> 00:04:47,920
ainda chamamos

57
00:04:47,950 --> 00:04:50,210
em nosso, tentamos assin-lo no cdigo.

58
00:04:50,530 --> 00:04:54,340
Ento, agora j estamos usando o novo criador de

59
00:04:54,670 --> 00:05:02,800
aes e, como tambm percebemos que o logout de autenticao foi enviado, percebemos que nossa saga est funcionando porque no

60
00:05:02,800 --> 00:05:10,390
estamos mais enviando isso de qualquer lugar em nosso criador de aes de autenticao, esse tipo de ao logout

61
00:05:10,480 --> 00:05:14,610
no  mais usado aqui,  o auth initte logout,

62
00:05:14,880 --> 00:05:17,000
ento nossa saga j est funcionando.

63
00:05:17,050 --> 00:05:20,260
Agora vamos confirmar isso, realmente fazendo login aqui

64
00:05:23,130 --> 00:05:25,130
e clicando no boto de

65
00:05:25,350 --> 00:05:29,530
logout e samos e agora vamos verificar a guia do aplicativo

66
00:05:32,300 --> 00:05:36,570
para ver se no armazenamento local, ainda temos um token e

67
00:05:36,650 --> 00:05:37,470
no, est vazio.

68
00:05:37,580 --> 00:05:39,060
Ento, de fato, ns

69
00:05:39,110 --> 00:05:41,270
limpamos, ns chamamos remover item,

70
00:05:41,330 --> 00:05:44,360
ento a saga do redux funcionou aqui.

71
00:05:44,380 --> 00:05:52,730
Agora vamos mergulhar mais fundo para tornar isso mais claro e substituir todos os nossos efeitos colaterais nos criadores

72
00:05:52,970 --> 00:05:55,480
de ao com geradores de saga.

