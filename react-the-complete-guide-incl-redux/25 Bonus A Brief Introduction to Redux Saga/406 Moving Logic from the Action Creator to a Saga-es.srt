1
00:00:02,150 --> 00:00:07,760
As que trabajamos muchas sagas, pero supongo que todava es un poco

2
00:00:07,850 --> 00:00:09,850
confuso, pronto se aclarar.

3
00:00:09,860 --> 00:00:13,020
Vamos a la autenticacin. js archivo en la carpeta

4
00:00:13,100 --> 00:00:16,840
de acciones, all tenemos nuestro creador de acciones de cierre de

5
00:00:17,030 --> 00:00:20,080
sesin y aqu, quiero hacer un cambio muy importante.

6
00:00:20,210 --> 00:00:25,810
Voy a tomar todo el cdigo de almacenamiento local y voy a comentarlo aqu, en cambio

7
00:00:25,940 --> 00:00:28,010
aqu, realmente solo quiero enviar una

8
00:00:28,020 --> 00:00:30,530
accin, quiero crear una accin, nada ms.

9
00:00:30,530 --> 00:00:35,990
No quiero tener ms efectos secundarios porque quiero manejarlos ahora con la

10
00:00:36,010 --> 00:00:36,760
saga redux.

11
00:00:37,190 --> 00:00:45,270
Entonces, lo que har es enviar algo aqu y crear un nuevo tipo de accin para esto, as que adems

12
00:00:45,290 --> 00:00:54,290
de cerrar la sesin de autenticacin, exportar una nueva constante en la carpeta de tipos de accin que denominar AUTH_INITIATE_LOGOUT porque es

13
00:00:54,740 --> 00:00:59,220
una especie de paso antes de que realmente cierre la sesin,

14
00:01:00,100 --> 00:01:01,390
hay un error tipogrfico.

15
00:01:01,730 --> 00:01:08,070
De nuevo, como siempre, recibiremos el mismo identificador que una cadena como llamamos

16
00:01:08,320 --> 00:01:17,080
a la constante y ahora volver a la autenticacin. js actions file y aqu, enviar los tipos de accin

17
00:01:17,080 --> 00:01:20,020
AUTH_INITIATE_LOGOUT y no cerrar sesin de autenticacin,

18
00:01:20,080 --> 00:01:27,290
as que cada vez que despacho el cierre de sesin, simplemente iniciar el cierre de sesin.

19
00:01:27,640 --> 00:01:35,530
Ahora el objetivo es escuchar a este creador de accin recin creado y ejecutar nuestro generador de saga de cierre de

20
00:01:35,560 --> 00:01:43,900
sesin siempre que detectemos esta llamada de cierre de sesin iniciada. Para eso, crear un nuevo archivo en la carpeta sagas, lo

21
00:01:44,100 --> 00:01:45,640
nombrar ndice. js, tambin puedes

22
00:01:45,670 --> 00:01:50,640
nombrar root, saga o lo que quieras. En ndice. js, simplemente importar

23
00:01:50,720 --> 00:01:59,520
algo del archivo auth saga y ese algo es, por supuesto, la nica saga que tengo hasta ahora,

24
00:01:59,520 --> 00:02:01,910
la saga de cierre de

25
00:02:02,010 --> 00:02:07,270
sesin, pero tambin importar algo de este paquete de la saga redux.

26
00:02:07,270 --> 00:02:15,820
As que de la saga redux, voy a importar takeEvery, esa es otra funcin

27
00:02:15,960 --> 00:02:25,320
til que podemos usar y tomar. Every nos permitir escuchar ciertas acciones y hacer algo

28
00:02:25,320 --> 00:02:27,350
cuando ocurran, ahora

29
00:02:27,570 --> 00:02:29,470
cmo lo usamos?

30
00:02:29,550 --> 00:02:36,450
En primer lugar, creamos otro generador, por lo que una funcin con esta estrella despus

31
00:02:36,450 --> 00:02:37,420
de la

32
00:02:37,480 --> 00:02:46,130
palabra clave de la funcin y lo nombrar watchAuth. Ahora aqu voy a ceder algo como lo tenemos que hacer

33
00:02:46,120 --> 00:02:53,610
en generadores, bsicamente digo ejecutar esto y esperar a que termine y luego tomarEvery, la funcin que importo y

34
00:02:53,630 --> 00:02:55,010
tomarEvery, ahora voy

35
00:02:55,210 --> 00:03:03,410
a pasar la accin que quiero escuchar, as que tambin importar eso, importar todo como tipos de accin y ahora

36
00:03:03,430 --> 00:03:09,820
vamos a la carpeta de acciones en el archivo de tipos de accin y aqu escuchar

37
00:03:10,030 --> 00:03:12,510
cada accin de tipo iniciar sesin.

38
00:03:13,060 --> 00:03:20,130
Ahora tomeEvery toma un segundo argumento, este segundo argumento es el generador, la saga que luego queremos

39
00:03:20,140 --> 00:03:21,490
ejecutar cuando se

40
00:03:21,490 --> 00:03:26,200
produce esta accin y esa sera la saga de cierre de sesin.

41
00:03:26,200 --> 00:03:32,500
Ahora no ejecute la funcin, as que no use parntesis aqu, simplemente pase una referencia a ella.

42
00:03:32,650 --> 00:03:38,910
Lo que esto har es que cada vez que ejecutemos este generador, bsicamente configuraremos un oyente

43
00:03:38,920 --> 00:03:45,610
para que en este caso auth inicie sesin y luego ejecute logout saga cada vez que aparezca.

44
00:03:46,060 --> 00:03:52,300
Entonces ahora podemos ir al ndice. js aqu y ya no queremos ejecutar la sesin de inicio

45
00:03:52,750 --> 00:03:56,630
de sesin al principio, sino que ejecutamos el generador donde configuramos este monitor.

46
00:03:56,890 --> 00:04:04,250
Entonces en el ndice. js, ya no importar saga de cierre de sesin de sagas

47
00:04:04,270 --> 00:04:08,430
auth, en lugar de sagas / ndice que puedo omitir debido a

48
00:04:08,470 --> 00:04:15,400
nuestra configuracin aqu, quiero importar nuestra funcin watchAuth recin creada y por lo tanto, por supuesto, tendr que agregar la exportar

49
00:04:15,410 --> 00:04:16,780
palabra clave a ella.

50
00:04:16,780 --> 00:04:24,250
Ahora con eso, puedo importar watchAuth y quiero ejecutar watchAuth, configurando el monitor justo

51
00:04:24,250 --> 00:04:26,570
al inicio de nuestra aplicacin.

52
00:04:26,590 --> 00:04:29,630
Ahora regresemos a nuestra aplicacin y veamos si

53
00:04:29,630 --> 00:04:38,800
eso funciona ahora, si lo vuelvo a cargar, todo se ve como lo haca antes, pero vemos un cambio importante, se enva auth iniciar

54
00:04:38,800 --> 00:04:40,450
sesin y eso tiene

55
00:04:40,450 --> 00:04:46,900
sentido porque ahora estamos enviando esto en nuestro creador de acciones de cierre de sesin que todava

56
00:04:46,900 --> 00:04:47,920
llamamos en nuestro

57
00:04:47,950 --> 00:04:50,210
intento de firmarlo en el cdigo.

58
00:04:50,530 --> 00:04:54,340
Ahora que ya estamos usando el nuevo creador de acciones y

59
00:04:54,670 --> 00:05:02,800
dado que tambin vemos que se cerr el cierre de sesin de autenticacin, vemos que nuestra saga est funcionando porque ya no enviamos esto

60
00:05:02,800 --> 00:05:10,390
desde ningn lugar de nuestro creador de acciones de autenticacin, este tipo de accin de El cierre de sesin ya no se

61
00:05:10,480 --> 00:05:14,610
usa aqu, en su lugar, iniciamos el cierre de sesin, por lo

62
00:05:14,880 --> 00:05:17,000
que nuestra saga ya est funcionando.

63
00:05:17,050 --> 00:05:20,260
Ahora confirmemos esto iniciando sesin aqu y luego presionando

64
00:05:23,130 --> 00:05:25,130
el botn de cerrar sesin, y

65
00:05:25,350 --> 00:05:29,530
lo firmamos y ahora revisemos la pestaa de la aplicacin para ver

66
00:05:32,300 --> 00:05:36,570
si en el almacenamiento local todava tenemos un token y no, est

67
00:05:36,650 --> 00:05:37,470
vaco.

68
00:05:37,580 --> 00:05:39,060
As que de

69
00:05:39,110 --> 00:05:41,270
hecho lo aclaramos, llamamos remove

70
00:05:41,330 --> 00:05:44,360
item, as que redux saga funcion aqu.

71
00:05:44,380 --> 00:05:52,730
Ahora profundicemos para aclarar esto y para reemplazar todos nuestros efectos secundarios en los creadores de

72
00:05:52,970 --> 00:05:55,480
accin con generadores de saga.

