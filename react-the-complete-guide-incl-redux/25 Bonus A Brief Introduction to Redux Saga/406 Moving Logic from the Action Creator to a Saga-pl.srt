1
00:00:02,150 --> 00:00:07,760
Wic przepracowalimy wiele sag, ale zakadam, e to jeszcze troch zagmatwane,

2
00:00:07,850 --> 00:00:09,850
wkrtce stanie si janiejsze.

3
00:00:09,860 --> 00:00:13,020
Przejdmy do auth. Plik js w

4
00:00:13,100 --> 00:00:16,840
folderze actions, tam mamy naszego twrc akcji wylogowania

5
00:00:17,030 --> 00:00:20,080
i tutaj, chc dokona bardzo wanej zmiany.

6
00:00:20,210 --> 00:00:25,810
Mam zamiar wzi cay lokalny kod pamici i mam zamiar go skomentowa tutaj,

7
00:00:25,940 --> 00:00:28,010
zamiast tego, naprawd chc wysa

8
00:00:28,020 --> 00:00:30,530
akcj, chc stworzy akcj, nic wicej.

9
00:00:30,530 --> 00:00:35,990
Nie chc ju mie adnych efektw ubocznych, poniewa chc teraz poradzi sobie z

10
00:00:36,010 --> 00:00:36,760
sag redux.

11
00:00:37,190 --> 00:00:45,270
To co zrobi, to wyl co tutaj i utworz dla tego nowy typ akcji,

12
00:00:45,290 --> 00:00:54,290
wic oprcz wylogowania si z auth wyeksportuj now sta w folderze typw dziaa, ktr nazwiemy AUTH_INITIATE_LOGOUT,

13
00:00:54,740 --> 00:00:59,220
poniewa jest to rodzaj zanim naprawd si wylogujemy,

14
00:01:00,100 --> 00:01:01,390
pojawia si literwka.

15
00:01:01,730 --> 00:01:08,070
Bdzie to ponownie, jak zawsze, otrzyma ten sam identyfikator, co

16
00:01:08,320 --> 00:01:17,080
cig znakw, a teraz wrc do auth. Plik akcji js i tutaj, wylemy typy akcji

17
00:01:17,080 --> 00:01:20,020
AUTH_INITIATE_LOGOUT i nie bd ju

18
00:01:20,080 --> 00:01:27,290
wylogowywa, wic za kadym razem, gdy wysyam wylogowanie, bd po prostu inicjowa wylogowanie.

19
00:01:27,640 --> 00:01:35,530
Teraz celem jest wysuchanie tego nowo stworzonego twrcy akcji i wykonanie naszego generatora saga wylogowania

20
00:01:35,560 --> 00:01:43,900
za kadym razem, gdy wykryjemy to inicjowane wylogowanie. W tym celu utworz nowy plik w folderze sagas, nazw

21
00:01:44,100 --> 00:01:45,640
go indeksem. js, moesz rwnie

22
00:01:45,670 --> 00:01:50,640
nazwa root, saga lub cokolwiek chcesz. W indeksie. js, po prostu

23
00:01:50,720 --> 00:01:59,520
zaimportuj co z pliku auth sagi i e co jest oczywicie jedyn sag, jak miaem do

24
00:01:59,520 --> 00:02:01,910
tej pory, sag logoutow,

25
00:02:02,010 --> 00:02:07,270
ale take zaimportuj co z tego pakietu sag redux.

26
00:02:07,270 --> 00:02:15,820
Tak wic, z sagi redux, zaimportuj takeEvery, to kolejna przydatna funkcja, ktrej moemy uy

27
00:02:15,960 --> 00:02:25,320
i ktr wemiemy. Pozwoli nam to wysucha pewnych czynnoci i zrobi co, gdy si pojawi,

28
00:02:25,320 --> 00:02:27,350
a teraz jak

29
00:02:27,570 --> 00:02:29,470
z niego korzysta?

30
00:02:29,550 --> 00:02:36,450
Najpierw tworzymy kolejny generator, wic funkcja z t gwiazdk po

31
00:02:36,450 --> 00:02:37,420
sowach

32
00:02:37,480 --> 00:02:46,130
funkcji, a ja nadam jej nazw watchAuth. Teraz tutaj przynios co, co musimy zrobi w generatorach,

33
00:02:46,120 --> 00:02:53,610
mwic w zasadzie, wykonajcie to i czekajcie, a to si skoczy, a potem zabierzcie Wszystko, funkcj,

34
00:02:53,630 --> 00:02:55,010
ktr importuj i

35
00:02:55,210 --> 00:03:03,410
zabieram. Przejd teraz do akcji, ktrej chc sucha, wic rwnie importuj to, importuj wszystko jako typy akcji,

36
00:03:03,430 --> 00:03:09,820
a teraz przejdmy do folderu dziaa do pliku typw akcji i tutaj posucham

37
00:03:10,030 --> 00:03:12,510
kadej akcji typu rozpocznij wylogowywanie.

38
00:03:13,060 --> 00:03:20,130
Teraz we TakeEvery pobiera drugi argument, ten drugi argument jest generatorem, sag, ktr

39
00:03:20,140 --> 00:03:21,490
chcemy wykona, gdy

40
00:03:21,490 --> 00:03:26,200
ta akcja si pojawi i bdzie to saga logoutowa.

41
00:03:26,200 --> 00:03:32,500
Teraz nie wykonuj tej funkcji, wic nie uywaj w tym miejscu nawiasw, wystarczy poda odniesienie do niej.

42
00:03:32,650 --> 00:03:38,910
To, co to zrobi, to to, e za kadym razem, gdy wykonamy ten generator, w zasadzie

43
00:03:38,920 --> 00:03:45,610
ustawimy detektor, aby w tym przypadku auth zainicjowa wylogowanie, a nastpnie wykona sag wylogowania, gdy tylko si pojawi.

44
00:03:46,060 --> 00:03:52,300
Teraz moemy przej do indeksu. Plik js tutaj i nie chcemy ju uruchamia sagi wylogowania

45
00:03:52,750 --> 00:03:56,630
na pocztku, a zamiast tego uruchomi generator, w ktrym ustawilimy tego obserwatora.

46
00:03:56,890 --> 00:04:04,250
Wic w indeksie. js, nie bd ju importowa sag z logw sagas,

47
00:04:04,270 --> 00:04:08,430
zamiast sag / indeksu, ktre mog pomin z powodu naszego

48
00:04:08,470 --> 00:04:15,400
ustawienia tutaj, chc zaimportowa nasz nowo utworzon funkcj watchAuth i dlatego oczywicie bd musia doda wyeksportuj do

49
00:04:15,410 --> 00:04:16,780
niej sowo kluczowe.

50
00:04:16,780 --> 00:04:24,250
Teraz mog zaimportowa watchAuth i chc uruchomi watchAuth, ustawiajc obserwatora na

51
00:04:24,250 --> 00:04:26,570
samym pocztku naszej aplikacji.

52
00:04:26,590 --> 00:04:29,630
Wrmy teraz do naszej aplikacji i zobaczmy,

53
00:04:29,630 --> 00:04:38,800
czy to dziaa teraz, jeli przeadowuj j, wszystko wyglda tak, jak byo wczeniej, widzimy jedn wan zmian, jednak wywoanie auth

54
00:04:38,800 --> 00:04:40,450
inicjuje wylogowanie i ma

55
00:04:40,450 --> 00:04:46,900
to sens, poniewa teraz wysyamy to w nasz twrca akcji wylogowania, do ktrego wci

56
00:04:46,900 --> 00:04:47,920
wzywamy, staramy

57
00:04:47,950 --> 00:04:50,210
si podpisa w kodzie.

58
00:04:50,530 --> 00:04:54,340
Teraz uywamy ju nowego kreatora akcji i

59
00:04:54,670 --> 00:05:02,800
poniewa widzimy, e wylogowano si z authout, widzimy, e nasza saga dziaa, poniewa nie wysyamy tego

60
00:05:02,800 --> 00:05:10,390
z dowolnego miejsca w naszym auth action creator, ten typ akcji wylogowanie nie jest ju

61
00:05:10,480 --> 00:05:14,610
tutaj uywane, zamiast tego jest inicjowane wylogowywanie, wic

62
00:05:14,880 --> 00:05:17,000
nasza saga ju dziaa.

63
00:05:17,050 --> 00:05:20,260
Teraz potwierdmy to przez faktyczne zalogowanie si tutaj,

64
00:05:23,130 --> 00:05:25,130
a nastpnie nacinicie przycisku wylogowania

65
00:05:25,350 --> 00:05:29,530
i wylogowalimy si, a teraz sprawdmy kart aplikacji, aby sprawdzi,

66
00:05:32,300 --> 00:05:36,570
czy w lokalnej pamici nadal mamy token, a my nie,

67
00:05:36,650 --> 00:05:37,470
jest pusty.

68
00:05:37,580 --> 00:05:39,060
Tak naprawd to

69
00:05:39,110 --> 00:05:41,270
wyczycilimy, zadzwonilimy do usuwanego

70
00:05:41,330 --> 00:05:44,360
elementu, wic dziaaa tutaj redux saga.

71
00:05:44,380 --> 00:05:52,730
Teraz zanurzmy si gbiej, aby uczyni to bardziej przejrzystym i zastpi wszystkie nasze efekty uboczne

72
00:05:52,970 --> 00:05:55,480
w twrcach akcji generatorami sagi.

